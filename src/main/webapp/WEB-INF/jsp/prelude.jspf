<%-- 
    Arquivo prelude JSP para configura√ß√µes globais da Livraria Online
    Este arquivo √© inclu√≠do automaticamente em todas as p√°ginas JSP
    Local: src/main/webapp/WEB-INF/jsp/prelude.jspf
--%>

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page session="true" %>
<%@ page errorPage="/erro.jsp" %>

<%-- Tags JSTL (se necess√°rio no futuro) --%>
<%-- <%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %> --%>
<%-- <%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %> --%>

<%-- Configura√ß√µes globais para todas as p√°ginas JSP --%>
<%
    // Configurar encoding para todas as p√°ginas
    response.setCharacterEncoding("UTF-8");
    
    // Configurar cabe√ßalhos de cache (desenvolvimento)
    response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
    response.setHeader("Pragma", "no-cache");
    response.setDateHeader("Expires", 0);
    
    // Vari√°veis globais √∫teis
    String contextPath = request.getContextPath();
    String serverName = request.getServerName();
    int serverPort = request.getServerPort();
    String baseURL = request.getScheme() + "://" + serverName + ":" + serverPort + contextPath;
%>

<%-- Disponibilizar vari√°veis para uso nas p√°ginas JSP --%>
<% 
    pageContext.setAttribute("contextPath", contextPath);
    pageContext.setAttribute("baseURL", baseURL);
%>

<%-- Meta tags padr√£o para SEO e responsividade --%>
<script>
    // Vari√°veis JavaScript globais dispon√≠veis em todas as p√°ginas
    window.CONTEXT_PATH = '<%= contextPath %>';
    window.BASE_URL = '<%= baseURL %>';
    
    // Configura√ß√£o global para AJAX
    if (typeof $ !== 'undefined') {
        $.ajaxSetup({
            beforeSend: function(xhr) {
                xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            }
        });
    }
    
    // Log de debug
    console.log('üîß Prelude JSP carregado:', {
        contextPath: '<%= contextPath %>',
        baseURL: '<%= baseURL %>',
        sessionId: '<%= session.getId() %>'
    });
</script>

<%-- Fun√ß√£o utilit√°ria para formata√ß√£o de pre√ßos --%>
<%!
    public String formatarPreco(double preco) {
        return String.format("%.2f", preco).replace(".", ",");
    }
    
    public String formatarPreco(java.math.BigDecimal preco) {
        if (preco == null) return "0,00";
        return formatarPreco(preco.doubleValue());
    }
%>